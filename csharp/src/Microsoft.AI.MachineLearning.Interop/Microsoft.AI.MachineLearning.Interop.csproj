<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <ProjectName>Microsoft.AI.MachineLearning.Interop</ProjectName>
    <TargetFramework>netstandard2.0</TargetFramework>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform>AnyCPU</Platform>
    <OutputPath>bin\$(Platform)\$(Configuration)\</OutputPath>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <OnnxRuntimeBuildDirectory Condition="'$(OnnxRuntimeBuildDirectory)'==''">..\..\..\build\Windows</OnnxRuntimeBuildDirectory>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Windows.SDK.NET" Version="10.0.18362.3-preview" />
  </ItemGroup>

  <ItemGroup>
    <Folder Include="Generated Files\" />
  </ItemGroup>

  <Target Name="GenerateProjection" BeforeTargets="DispatchToInnerBuilds;Build">
    <ConvertToAbsolutePath Paths="$(OnnxRuntimeBuildDirectory)">
      <Output TaskParameter="AbsolutePaths" PropertyName="OnnxRuntimeBuildDirectoryAbs"/>
    </ConvertToAbsolutePath>

    <ItemGroup>
      <WindowsAIsWinMDs Include="$(OnnxRuntimeBuildDirectoryAbs)\$(Configuration)\Microsoft.AI.MachineLearning.winmd" />
    </ItemGroup>
    <PropertyGroup>
      <CsWinRTExe>$(OnnxRuntimeBuildDirectoryAbs)\packages\Microsoft.Windows.CsWinRT.0.1.0-prerelease.200512.7\cswinrt.exe</CsWinRTExe>
      <CsWinRTCommand>$(CsWinrtExe) -verbose -in 10.0.18362.0 -in @(WindowsAIsWinMDs->'"%(FullPath)"', ' ') -out "$(ProjectDir)Generated Files" -include Microsoft.AI.MachineLearning</CsWinRTCommand>
    </PropertyGroup>

    <Message Text="$(CsWinRTCommand)"/>

    <Exec Command="$(CsWinRTCommand)" />
  </Target>

</Project>

<!-- msbuild Microsoft.AI.MachineLearning.Interop.csproj /p:Configuration=RelWithDebInfo /p:Platform=x64 -restore -->